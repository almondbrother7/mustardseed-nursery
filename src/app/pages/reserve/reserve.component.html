<div class="reserve-header">
  <h1>Reserve some plants</h1>
  <p>
    Use this form to select plants and it will open a summary panel to the right where you can increase the quantity.
    Clicking on Continue will go to the Contact form where you can send your reservation to us.
  </p>
</div>

<div class="reserve-page-container">
  <!-- Plant List -->
  <div class="plant-catalog">
    <mat-form-field appearance="fill" class="category-filter">
      <mat-label>Filter by Categories</mat-label>
      <mat-select [(ngModel)]="selectedCategories" multiple (selectionChange)="updateFilteredPlants()">
        <mat-option *ngFor="let category of categories" [value]="category">
          {{ categoryLabelMap[category] || category }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Filtered Plant List -->
    <div class="plant-card" *ngFor="let plant of filteredPlants" [id]="'plant-' + plant.plantID">
      <img [src]="'/' + plant.thumbnail" [alt]="plant.name" />

      <h3>
        <a *ngIf="plant.infoUrl" [href]="plant.infoUrl" target="_blank">
          {{ plant.name }}
        </a>
      </h3>

      <p>{{ plant.description }}</p>

      <p class="price-available">
        <strong>Price:</strong> ${{ plant.price }} &nbsp;|&nbsp;
        <strong>Available:</strong> {{ plant.inventory }}
      </p>

      <button
        mat-stroked-button
        color="primary"
        (click)="reservePlant(plant)"
        [disabled]="plant.inventory === 0"
      >
        Reserve
      </button>

    </div>
  </div>

  <!-- Reservation summary sidebar -->
  <aside class="reservation-summary" *ngIf="reservedItems.length > 0">
    <div class="summary-header">
    <h3>Your Reservation</h3>
      <button
        mat-icon-button
        color="warn"
        (click)="clear()"
        aria-label="Clear reservation"
      >
        <mat-icon>close</mat-icon>
      </button>
  </div>
    <div *ngFor="let item of reservedItems" 
      class="summary-item"
      [class.highlight]="item.plant.plantID === highlightedPlantID"
    >
      <div 
        class="summary-name"
        (click)="scrollToPlant(item.plant.plantID)"
        >{{ item.plant.name }}
      </div>

      <div class="summary-controls">
        <label>
          Qty:
          <input
            type="number"
            min="1"
            [max]="item.plant.inventory"
            [(ngModel)]="item.quantity"
            (change)="updateQuantity(item.plant.plantID, item.quantity)"
          />
        </label>

        <button mat-icon-button (click)="removeItem(item.plant.plantID)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>

      <div class="summary-price">
        {{ item.quantity * item.plant.price | currency }}
      </div>
    </div>

    <hr />

    <div class="subtotal">
      <strong>Total:</strong> {{ getSubtotal() | currency }}
    </div>

    <button
      mat-raised-button
      color="primary"
      class="continue-button"
      (click)="reserveOrder()"
    >
      Continue
    </button>

  </aside>
</div>