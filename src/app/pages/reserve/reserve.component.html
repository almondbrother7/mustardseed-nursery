<div class="reserve-header">
  <h1>Reserve some plants</h1>
  <p>
    Use this form to select plants and it will open a summary panel to the right where you can increase the quantity.
    Clicking on Continue will go to the Contact form where you can send your reservation to us.
  </p>
</div>

<div class="reserve-page-container">
  <!-- Plant List -->
  <div class="plant-catalog">

    <!-- Toolbar -->
    <div class="toolbar-grid">
      <div class="toolbar-labels">
        <div>Filter by Categories</div>
        <div>Sort by</div>
        <div>Direction</div>
      </div>

      <div class="toolbar-controls">
        <app-category-select
          class="category-control"
          [selectedCategories]="selectedCategories"
          [categories]="categories"
          [categoryLabelMap]="categoryLabelMap"
          (selectionChange)="onSelectionChange($event)">
        </app-category-select>

        <mat-form-field appearance="fill" class="sort-dropdown">
          <mat-select [(ngModel)]="sortField" (ngModelChange)="updateFilteredPlants()">
            <mat-option value="name">Name</mat-option>
            <mat-option value="price">Price</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="sort-toggle-wrap">
          <mat-button-toggle-group
            name="sortDir"
            [(ngModel)]="sortDir"
            (ngModelChange)="updateFilteredPlants()"
            aria-label="Sort direction">
            <mat-button-toggle value="asc">Asc</mat-button-toggle>
            <mat-button-toggle value="desc">Desc</mat-button-toggle>
          </mat-button-toggle-group>
        </div>
      </div>
    </div>

    <!-- Filtered Plant List -->
    <div class="plant-list">
      <div
        class="plant-card"
        *ngFor="let plant of filteredPlants"
        [id]="'plant-' + plant.plantID"
        [class.is-out]="plant.inventory <= 0">

        <!-- Hero image with top banner -->
        <div class="reserve-hero banner-wrap"
             [class.is-out]="plant.inventory <= 0"
             [attr.aria-label]="plant.inventory <= 0 ? 'Out of stock' : null">
          <img
            [src]="normalizeAssetPath(plant.thumbnail) || defaultThumb"
            (error)="onImgError($event)"
            [alt]="plant.name" />
          <div class="stock-banner" *ngIf="plant.inventory <= 0">OUT OF STOCK</div>
        </div>

        <h3>
          <ng-container *ngIf="safeHref(plant.infoUrl); else noLink">
            <a [href]="plant.infoUrl" target="_blank" rel="noopener noreferrer">
              {{ plant.name }}
            </a>
          </ng-container>
          <ng-template #noLink>{{ plant.name }}</ng-template>
        </h3>

        <p>{{ plant.description }}</p>

        <p class="price-available">
          <strong>Price:</strong> ${{ plant.price }} &nbsp;|&nbsp;
          <strong>Available:</strong>
          <span class="availability-badge"
                [class.zero]="plant.inventory <= 0"
                [class.low]="plant.inventory > 0 && plant.inventory <= 3">
            {{ plant.inventory }}
          </span>
        </p>

        <button mat-stroked-button color="primary"
                (click)="reservePlant(plant)" *ngIf="plant.inventory > 0">
          Reserve
        </button>

        <button mat-stroked-button color="primary"
                *ngIf="plant.inventory <= 0"
                (click)="expressInterest(plant)">
          Express interest
        </button>
      </div>
    </div> <!-- /plant-list -->
  </div> <!-- .plant-catalog -->

  <!-- Reservation summary sidebar -->
  <aside class="reservation-summary" *ngIf="reservedItems.length > 0">
    <div class="summary-header">
      <h3>Your Reservation</h3>
      <button mat-icon-button color="warn" (click)="clear()" aria-label="Clear reservation">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="summary-item"
         *ngFor="let item of reservedItems"
         [class.highlight]="item.plant.plantID === highlightedPlantID">
      <div class="summary-name" (click)="scrollToPlant(item.plant.plantID)">
        {{ item.plant.name }}
      </div>

      <div class="summary-controls">
        <label>
          Qty:
          <input type="number" min="1" [max]="item.plant.inventory"
            [(ngModel)]="item.quantity"
            (change)="updateQuantity(item.plant.plantID, item.quantity)" />
        </label>
        <button mat-icon-button (click)="removeItem(item.plant.plantID)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>

      <div class="summary-price">
        {{ item.quantity * item.plant.price | currency }}
      </div>
    </div>

    <hr />

    <div class="subtotal"><strong>Total:</strong> {{ getSubtotal() | currency }}</div>

    <button mat-raised-button color="primary" class="continue-button" (click)="reserveOrder()">
      Continue
    </button>
  </aside>
</div> <!-- .reserve-page-container -->
